<template>
	<div>
		<div class="wraper-bg" ref="wraperBg">
			<!-- <img src="../../../assets/images/activetybg.png"> -->
			<img v-for="(v,i) in h5backgroundpic" :src="v" :key="i">
		</div>
		<div class="content" ref="content">
			<ul>
				<li v-for="(item,index) in goodsList" class="list" @click.prevent="goGoodsDetail(item.spuid)" :key="index">
					<img v-lazy="{src: item.goodslistpicurl,loading: 'https://devimg.manjd.net/default/200-200/2017101.png'}">
					<p>{{item.goodsname}}</p>
					<div class="price">
						<span>¥{{item.goodsprice}}</span>
						<span>赚¥{{item.goodsprofit}}</span>
					</div>
				</li>
			</ul>
		</div>
		<!-- 全部商品先开发，后续用到时候再打开入口 -->
		<div class="all-goods" @click="toAllGoods" v-show="false">全部<br>商品</div>
	</div>
</template>

<script>
	import { Active } from '@/apis';
	import Indicator from '@/components/common/indicator';
	import { getAppType, InitBridge } from '@/utils/common';
	import '@/assets/styles/common';
	export default {
		data(){
			return {
				appVersion:'',
				tabid:'',
				goodsList: [],//商品信息
				h5headtitle: '', //title
				h5backgroundpic: [] //背景图片url地址
			}
		},
		methods:{
			init(){
				var that = this;
				this.appVersion = getAppType();
				// 活动H5专题介绍页面背景信息获取 code 1 成功 -1 失败 -2 参数错误
				Active.getTitle({
					activityid: this.getQueryString('activityid')
				}).then(res=>{
					that.h5headtitle = res && res.data.h5headtitle;
					document.title = res && res.data.h5headtitle;
					that.h5backgroundpic = res && res.data.h5backgroundpic;
					that.tabid = res && res.data.activitytabs[0].tabid;
					Indicator.close();
				}).catch(err=>{
					Indicator.close();
				});
				Active.getGoodsList({
					activityid: this.getQueryString('activityid')
				}).then(res=>{
					if(res.code != 1){
						return false;
					}
					that.goodsList = res.data;
					Indicator.close();
				}).catch(err=>{
					Indicator.close();
				});
			},
			getQueryString(name) {
				var result = window.location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
				if (result == null || result.length < 1) {
					return "";
				}
				return result[1];
			},
			
			// 跳转商品详情
            goGoodsDetail(spuid) {
                let that = this;
                try {
                    InitBridge(function (bridge) {
                        if (that.appVersion === 'ios') {
                            bridge.callHandler('goToGoodsDetailMethod', spuid, function (data) { });
                        } else {
                            bridge.goToGoodsDetailMethod(spuid);
                        }
                    }); 
                } catch (error) {
                    
                }
			},
			toAllGoods(){
				window.location.href = `../specialactivety/list.html?tabid=${this.tabid}`;
			}
		},
		created(){
			Indicator.show('加载中...');
		},
		mounted(){
			this.init();
		}
	}
</script>

<style>
	@import '../../../assets/styles/mixins.css';
	.wraper-bg{
		font-size: 0;
	}
	.wraper-bg img{
		width: 100%;
	}
	.content{
		position: absolute;
		top: 8rem;
		left: 50%;
		width: 6.86rem;
		margin-left: -3.43rem;
		background: #fff;
		border-radius: 0.06rem;
	}
	.content ul{
		display: -webkit-flex;
		display: flex;
		flex-wrap: wrap;
	}
	.content .list{
		width: 3rem;
		margin: .2rem;
		font-size: .26rem;
	}
	.content .list img{
		width: 3rem;
		height:3rem;
	}
	.content .list p{
		margin: .24rem 0 .28rem;
		line-height: .34rem;
		min-height: .68rem;
	}
	.content .list .price span:last-child{
		margin-left: .26rem;
		font-size: .24rem;
		color: #FF681D;
	}
	.all-goods{
		position: fixed;
		top: 10rem;
		right: .5rem;
		padding: .2rem;
		font-size: .14rem;
		color:#fff;
		background: #f60;
		border-radius: 50%;
	}

</style>